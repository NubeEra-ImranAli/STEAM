{% extends 'teacher/teacherbase.html' %}
{% block content %}
{% load static %}
{% load steam_filters %}
<style>
    .btn-spacing {
        margin-bottom: 10px; /* Adjust as needed */
    }
    .pagination {
        margin-top: 20px;
    }
    /* Ensure the progress bar fits the height of the table cell */
td .progress {
    height: 30px; /* Adjust this value as needed to fit the cell height */
}

td .progress-bar {
    height: 100%;  /* Ensure the progress bar fills the entire height of the progress div */
    line-height: 30px; /* Vertically center the text inside the bar */
    color: #fff;  /* White text color */
    text-align: center;  /* Center the text inside the bar */
    font-weight: bold;  /* Make the text bold */
}
</style>
<div class="card students-list">
    
    <div class="card-header border-0 flex-wrap pb-0">
        <h4>Student List</h4>
        
        <form method="GET" action="{% url 'student-list' %}" class="form-inline">
            <div class="input-group ">
                <div class="input-group">
                    <span class="input-group-text">
                        <a href="javascript:void(0)">
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 32 32"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path d="M27.414 24.586L22.337 19.509C23.386 17.928 24 16.035 24 14C24 8.486 19.514 4 14 4C8.486 4 4 8.486 4 14C4 19.514 8.486 24 14 24C16.035 24 17.928 23.386 19.509 22.337L24.586 27.414C25.366 28.195 26.634 28.195 27.414 27.414C28.195 26.633 28.195 25.367 27.414 24.586ZM7 14C7 10.14 10.14 7 14 7C17.86 7 21 10.14 21 14C21 17.86 17.86 21 14 21C10.14 21 7 17.86 7 14Z" fill="var(--primary)"></path>
                            </svg>
                        </a>
                    </span>
                    <!-- Search input for name, username, or grade name -->
                    <input type="text" name="search" class="form-control" placeholder="Search"
                        value="{{ query }}">
                

                    <!-- Grade dropdown filter -->
                    <select name="grade_id" class="form-control">
                        <option value="">All Grades</option>
                        {% for grade in grades %}
                            <option value="{{ grade.id }}" {% if grade.id|stringformat:"s" == selected_grade %}selected{% endif %}>
                                {{ grade.grade_name }}
                            </option>
                        {% endfor %}
                    </select>

                    <!-- Division dropdown filter -->
                    <select name="division_id" class="form-control">
                        <option value="">All Divisions</option>
                        {% for division in divisions %}
                            <option value="{{ division.id }}" {% if division.id|stringformat:"s" == selected_division %}selected{% endif %}>
                                {{ division.division_name }}
                            </option>
                        {% endfor %}
                    </select>
                    
                    <button type="submit" class="btn btn-primary">Search</button>
                </div>
            </div>
        </form>
    </div>

    <div class="card-body py-0">
        <div class="table-responsive">
            <table class="table display mb-4">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>User Name</th>
                        <th>Grade</th>
                        <th>Division</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in users %}
                        <tr>
                            <td>{{ t.first_name }} {{ t.last_name }}</td>
                            <td>{{ t.username }}</td>
                            <td>{{ t.grade.grade_name }}</td>
                            <td>{{ t.division.division_name }}</td>
                            <td>
                                {% if t.watched_percentage > 0 %}
                                <div class="progress">
                                    <div class="progress-bar bg-danger"
                                         style='width: {{ t.watched_percentage }}%;'
                                         role="progressbar">
                                        {{ t.watched_percentage }}%
                                    </div>
                                </div>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Pagination Controls -->
            <nav>
                <ul class="pagination pagination-gutter">
                    {% if users.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if query %}&search={{ query }}{% endif %}{% if selected_grade %}&grade_id={{ selected_grade }}{% endif %}">
                                &laquo;
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ users.previous_page_number }}{% if query %}&search={{ query }}{% endif %}{% if selected_grade %}&grade_id={{ selected_grade }}{% endif %}">
                                &lsaquo;
                            </a>
                        </li>
                    {% endif %}
                    
                    {% for num in users.paginator.page_range %}
                        {% if users.number == num %}
                            <li class="page-item active"><a class="page-link">{{ num }}</a></li>
                        {% else %}
                            <li class="page-item"><a class="page-link" href="?page={{ num }}{% if query %}&search={{ query }}{% endif %}{% if selected_grade %}&grade_id={{ selected_grade }}{% endif %}">{{ num }}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if users.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ users.next_page_number }}{% if query %}&search={{ query }}{% endif %}{% if selected_grade %}&grade_id={{ selected_grade }}{% endif %}">
                                &rsaquo;
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ users.paginator.num_pages }}{% if query %}&search={{ query }}{% endif %}{% if selected_grade %}&grade_id={{ selected_grade }}{% endif %}">
                                &raquo;
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
</div>

{% endblock content %}
