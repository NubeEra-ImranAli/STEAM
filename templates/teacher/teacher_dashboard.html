{% extends 'teacher/teacherbase.html' %} {% load widget_tweaks %}
{% block content %}
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  .modal-content {
    text-align: center;
    /* Center text inside the modal */
  }
   /* Optional custom styling for progress bars */
   .progress-bar {
            text-align: center;
            font-weight: bold;
        }
        .progress-container {
            margin-bottom: 20px;
        }
</style>

<div class="row">
  <div class="col-12">
    {% if schedulers %}
    <div class="col-xl-6 ">
      
      <div class="card">
        <div class="container">
          <h1 class="text-center my-4">Lesson Progress</h1>
  
          <!-- Loop over events and display progress bars -->
          <div id="progressBars"></div>
      </div>
  
      <!-- jQuery (Bootstrap JS dependency) -->
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      
      <!-- Bootstrap JS for interactivity -->
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  
      <script>
          // Sample scheduler event data (replace with your server-side template data)
          const schedulerEvents = [
              {% for scheduler in schedulers %}
              {
                  title: "{{ scheduler.lesson.heading }}",
                  start: "{{ scheduler.start|date:'Y-m-d\\TH:i:s' }}",
                  end: "{{ scheduler.end|date:'Y-m-d\\TH:i:s' }}",
                  extendedProps: {
                      Grade: "{{ scheduler.grade.grade_name }}",
                      Division: "{{ scheduler.division.division_name }}",
                      Module: "{{ scheduler.module.module_name }}",
                      Lesson: "{{ scheduler.lesson.heading }}",
                      StatusSum: "{{ scheduler.status_sum|default:0 }}"  // Progress value (0-100)
                  }
              },
              {% endfor %}
          ];
          // List of Bootstrap progress bar background classes
        const progressBarColors = [
            'bg-success',   // Green
            'bg-info',      // Light blue
            'bg-warning',   // Yellow
            'bg-danger',    // Red
            'bg-primary',   // Blue
            'bg-secondary', // Gray
            'bg-light',     // Light gray
            'bg-dark'       // Dark gray
        ];

        // Function to get a random Bootstrap color class for the progress bar
        function getRandomProgressBarColor() {
            const randomIndex = Math.floor(Math.random() * progressBarColors.length);
            return progressBarColors[randomIndex];
        }
          // Function to render progress bars
          function renderProgressBars(events) {
              const container = document.getElementById('progressBars');
              events.forEach(event => {
                  const progress = Math.min(100, Math.max(0, event.extendedProps.StatusSum));  // Ensure progress is within 0-100%
                  const randomColorClass = getRandomProgressBarColor();
                  const progressBarHTML = `
                      <div class="progress-container">
                          <h5>${progress} % | Grade: ${event.extendedProps.Grade} | Division: ${event.extendedProps.Division} | Module: ${event.extendedProps.Module} | Lesson :  ${event.title}</h5>
                          <div class="progress">
                               <div class="progress-bar ${randomColorClass}" role="progressbar" style="width: ${progress}%" aria-valuenow="${progress}" aria-valuemin="0" aria-valuemax="100">
                              </div>
                          </div>
                      </div>
                  `;
                  
                  container.innerHTML += progressBarHTML;  // Append each progress bar to the container
              });
          }
  
          // Call the function to render the progress bars on the page
          renderProgressBars(schedulerEvents);
      </script>

      </div>
    </div>
    {% endif %}
    <div class="col-xl-6 ">
      <div class="card">
        <link href="/static/get/vendor/fullcalendar/css/main.min.css" rel="stylesheet" />

        <div class="card-body">
          <div id="calendar" class="app-fullcalendar fc fc-media-screen fc-direction-ltr fc-theme-standard"></div>
          <!-- Event Details Modal -->
          <div class="modal fade" id="eventDetailsModal" tabindex="-1" role="dialog" aria-labelledby="eventDetailsModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="eventDetailsModalLabel">Event Details</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <!-- Table to display event details -->
                  <table class="table table-bordered">
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>Title:</strong></td>
                      <td id="eventTitleDetails" style="text-align: left;"></td>
                    </tr>
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>Start:</strong></td>
                      <td id="eventStartDetails" style="text-align: left;"></td>
                    </tr>
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>End:</strong></td>
                      <td id="eventEndDetails" style="text-align: left;"></td>
                    </tr>
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>Grade:</strong></td>
                      <td id="eventGrade" style="text-align: left;"></td>
                    </tr>
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>Division:</strong></td>
                      <td id="eventDivision" style="text-align: left;"></td>
                    </tr>
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>Module:</strong></td>
                      <td id="eventModule" style="text-align: left;"></td>
                    </tr>
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>Lesson:</strong></td>
                      <td id="eventLesson" style="text-align: left;"></td>
                    </tr>
                    <tr>
                      <td style="text-align: left; width: 30%;"><strong>Complete:</strong></td>
                      <td id="eventStatusSum" style="text-align: left;">0 %</td>
                    </tr>
                  </table>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Required vendors -->
          <script src="/static/get/vendor/global/global.min.js"></script>
          <script src="/static/get/vendor/moment/moment.min.js"></script>

          <script src="/static/get/vendor/fullcalendar/js/main.min.js"></script>
          <script>
            "use strict";

            function fullCalender() {
              const schedulerEvents = [{%for scheduler in schedulers %} {
                  title: "{{ scheduler.lesson.heading }}",
                  start: "{{ scheduler.start|date:'Y-m-d\\TH:i:s' }}",
                  end: "{{ scheduler.end|date:'Y-m-d\\TH:i:s' }}",
                  extendedProps: {
                    Grade: "{{ scheduler.grade.grade_name }}",
                    Division: "{{ scheduler.division.division_name }}",
                    Module: "{{ scheduler.module.module_name }}",
                    Lesson: "{{ scheduler.lesson.heading }}",
                    StatusSum: "{{ scheduler.status_sum|default:0 }} %"
                  }
                },
                {% endfor %}
              ];
              var calendarEl = document.getElementById('calendar');
              var calendar = new FullCalendar.Calendar(calendarEl, {
                headerToolbar: {
                  left: 'prev,next today',
                  center: 'title',
                  right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                selectable: true,
                editable: false,
                initialDate: new Date().toISOString().slice(0, 10),
                events: schedulerEvents,
                eventClick: function(info) {
                  // Populate modal with event details
                  $('#eventTitleDetails').text(info.event.title);
                  $('#eventStartDetails').text(info.event.start.toLocaleString());
                  $('#eventEndDetails').text(info.event.end ? info.event.end.toLocaleString() : 'N/A');
                  $('#eventGrade').text(info.event.extendedProps.Grade);
                  $('#eventDivision').text(info.event.extendedProps.Division);
                  $('#eventModule').text(info.event.extendedProps.Module);
                  $('#eventTeacher').text(info.event.extendedProps.Teacher);
                  $('#eventLesson').text(info.event.extendedProps.Lesson);
                  $('#eventStatusSum').text(info.event.extendedProps.StatusSum);
                  // Show the modal
                  $('#eventDetailsModal').modal('show');
                }
              });
              calendar.render();
            }
            jQuery(window).on('load', function() {
              setTimeout(function() {
                fullCalender();
              }, 1000);
            });
          </script>

          
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock content %}