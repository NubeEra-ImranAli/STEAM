<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student List</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .pagination {
            margin-top: 20px;
        }
        .pagination a {
            margin: 0 5px;
            text-decoration: none;
            color: #007bff;
        }
        .pagination .current {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Student List</h1>

    <form id="search-form">
        <fieldset>
            <legend>Search by:</legend>
            
            <div>
                <label for="id_first_name">First Name:</label>
                <input type="text" id="id_first_name" name="first_name">
            </div>
            
            <div>
                <label for="id_last_name">Last Name:</label>
                <input type="text" id="id_last_name" name="last_name">
            </div>
            
            <div>
                <label for="id_email">Email:</label>
                <input type="text" id="id_email" name="email">
            </div>
            
            <div>
                <label for="id_gender">Gender:</label>
                <select id="id_gender" name="gender">
                    <option value="">-- Select Gender --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>
            
            <div>
                <label for="id_address">Address:</label>
                <input type="text" id="id_address" name="address">
            </div>
            
            <div>
                <label for="id_results_per_page">Results Per Page:</label>
                <select id="id_results_per_page" name="results_per_page">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
            
            <div>
                <button type="button" id="search-button">Apply</button>
            </div>
        </fieldset>
    </form>

    <h2>Results:</h2>
    <table id="results-table">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Gender</th>
                <th>Address</th>
            </tr>
        </thead>
        <tbody>
            <!-- Results will be inserted here by JavaScript -->
        </tbody>
    </table>

    <div class="pagination" id="pagination-controls">
        <!-- Pagination controls will be inserted here by JavaScript -->
    </div>

    <script>
        document.getElementById('search-button').addEventListener('click', function() {
            fetchResults();
        });

        function fetchResults(page = 1) {
    const formData = new URLSearchParams(new FormData(document.getElementById('search-form')));
    formData.set('page', page);

    fetch('{% url "student_list" %}?'+ formData.toString(), {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'  // This header indicates an AJAX request
        }
    })
    .then(response => response.json())
    .then(data => {
        updateTable(data.students);
        updatePagination(data);
    });
}

        function updateTable(students) {
            const tbody = document.querySelector('#results-table tbody');
            tbody.innerHTML = '';

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">No students found.</td></tr>';
                return;
            }

            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.first_name}</td>
                    <td>${student.last_name}</td>
                    <td>${student.email}</td>
                    <td>${student.gender}</td>
                    <td>${student.address}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePagination(data) {
            const paginationControls = document.getElementById('pagination-controls');
            paginationControls.innerHTML = '';

            let html = '';

            if (data.has_previous) {
                html += `<a href="#" onclick="fetchResults(${data.previous_page_number})">Previous</a>`;
            }

            html += `<span class="current">Page ${data.current_page} of ${data.total_pages}</span>`;

            if (data.has_next) {
                html += `<a href="#" onclick="fetchResults(${data.next_page_number})">Next</a>`;
            }

            paginationControls.innerHTML = html;
        }

        // Fetch initial results
        fetchResults();
    </script>
</body>
</html>
