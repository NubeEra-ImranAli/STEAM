{% extends 'steamapp/adminbase.html' %}
{% block content %}
{% load static %}
{% load guru_filters %}
<style>
    .btn-spacing {
    margin-bottom: 10px; /* Adjust as needed */
}
</style>

<div class="container-fluid">
    
    	
  
    <div class="row">
        <div id="message" class="alert" style="display: none;"></div>

        {% for t in users|sort_by_name %}
        <div class="col-xl-4 col-md-6">
            <div class="card all-crs-wid">
                <div class="card-body">
                    <div class="courses-bx">
                        <div class="dlab-media">
                            <img src="{{ t.profile_pic.url }}" alt="">
                        </div>
                        <div class="dlab-info">
                            <div class="dlab-title d-flex justify-content-between">
                                <div>
                                    <h4><a href="{% url 'update-user' t.id %}"><span>Name : {{t.first_name}}</span>
                                        {{t.last_name}}</a></h4>
                                        <h5><a href="{% url 'update-user' t.id %}"><span>User Name : {{t.username}}</span></a></h5>
                                        <h4 class="text-primary"><span>{{ t.mobile }}</span>/ {{ t.whatsappno }}</h4>
                                </div>	
                                
                            </div>
                            <div class="d-flex justify-content-between content align-items-center">
                                <a class="btn btn-xs btn-active {% if t.status %}btn-success{% else %}btn-info{% endif %}" href="#" data-user-id="{{ t.id }}">
                                    {% if t.status %}
                                        <span class="far fa-eye"></span><b>Active</b>
                                    {% else %}
                                        <span class="far fa-eye-slash"></span><b>On Hold</b>
                                    {% endif %}
                                </a>
                                <a class="btn btn-danger btn-xs btn-reset" href="#" data-user-id="{{ t.id }}">
                                    <span class="fas fa-skull-crossbones"></span><b>Reset Password</b>
                                </a>
                            </div>
                            
                            
                            
                            
                            
                            <BR><BR>
                            <div class="d-flex justify-content-between content align-items-center">
                                <div class="user-text">
                                    <a href="{% url 'admin-view-user-log-details' t.id %}">Check Login Details</a>
                                </div>
                                <div class="user-text">
                                    <a href="{% url 'admin-view-user-activity-details' t.id %}">Check Activity Details</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>	
{% endfor %}
        
    </div>
    
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get the message container
        var messageContainer = document.getElementById('message');

        // Handle user activation
        document.querySelectorAll('.btn-active').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                var userId = btn.getAttribute('data-user-id');

                fetch("{% url 'active-user' 0 %}".replace('0', userId), {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update button text and class based on new status
                        if (data.status) {
                            btn.classList.remove('btn-info');
                            btn.classList.add('btn-success');
                            btn.innerHTML = '<span class="far fa-eye"></span> <b>Active</b>';
                            messageContainer.textContent = 'User activated successfully!';
                        } else {
                            btn.classList.remove('btn-success');
                            btn.classList.add('btn-info');
                            btn.innerHTML = '<span class="far fa-eye-slash"></span> <b>On Hold</b>';
                            messageContainer.textContent = 'User put on hold.';
                        }
                        messageContainer.className = 'alert alert-success';  // Add success class
                    } else {
                        messageContainer.textContent = 'Error: ' + data.error;
                        messageContainer.className = 'alert alert-danger';  // Add error class
                    }
                    messageContainer.style.display = 'block';  // Show the message
                    setTimeout(() => {
                        messageContainer.style.display = 'none';  // Hide after 3 seconds
                    }, 3000);
                })
                .catch(() => {
                    messageContainer.textContent = 'An error occurred. Please try again.';
                    messageContainer.className = 'alert alert-danger';  // Add error class
                    messageContainer.style.display = 'block';  // Show the message
                    setTimeout(() => {
                        messageContainer.style.display = 'none';  // Hide after 3 seconds
                    }, 3000);
                });
            });
        });

        // Handle password reset
        document.querySelectorAll('.btn-reset').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                var userId = btn.getAttribute('data-user-id');

                fetch("{% url 'reset-user' 0 %}".replace('0', userId), {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        messageContainer.textContent = 'Password reset successfully!';
                        messageContainer.className = 'alert alert-success';  // Add success class
                    } else {
                        messageContainer.textContent = 'Error: ' + data.error;
                        messageContainer.className = 'alert alert-danger';  // Add error class
                    }
                    messageContainer.style.display = 'block';  // Show the message
                    setTimeout(() => {
                        messageContainer.style.display = 'none';  // Hide after 3 seconds
                    }, 3000);
                })
                .catch(() => {
                    messageContainer.textContent = 'An error occurred. Please try again.';
                    messageContainer.className = 'alert alert-danger';  // Add error class
                    messageContainer.style.display = 'block';  // Show the message
                    setTimeout(() => {
                        messageContainer.style.display = 'none';  // Hide after 3 seconds
                    }, 3000);
                });
            });
        });
    });
</script>




{% endblock content %}
